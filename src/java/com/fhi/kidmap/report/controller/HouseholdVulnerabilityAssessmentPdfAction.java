/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package com.fhi.kidmap.report.controller;

import com.fhi.kidmap.business.HouseholdEnrollment;
import com.itextpdf.text.BaseColor;
import com.itextpdf.text.Document;
import com.itextpdf.text.Element;
import com.itextpdf.text.Font;
import com.itextpdf.text.FontFactory;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

/**
 *
 * @author smomoh
 */
public class HouseholdVulnerabilityAssessmentPdfAction extends org.apache.struts.action.Action {
    
    /* forward name="success" path="" */
    private static final String SUCCESS = "success";
    
    /**
     * This is the action called from the Struts framework.
     * @param mapping The ActionMapping used to select this instance.
     * @param form The optional ActionForm bean for this request.
     * @param request The HTTP Request we are processing.
     * @param response The HTTP Response we are processing.
     * @throws java.lang.Exception
     * @return
     */
    @Override
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response)
            throws Exception
    {
        HttpSession session=request.getSession();
        Document document = new Document();
    try{
        response.setContentType("application/pdf");
        PdfWriter.getInstance(document, response.getOutputStream());
        document.open();
        document.left(0.5f);
        document.right(0.5f);
        
        Font f=FontFactory.getFont(FontFactory.HELVETICA, 8, Font.BOLD);
        String title="Household enrolment register";//(String)session.getAttribute("ovcrecordstitle");
        String ageTitle=(String)session.getAttribute("hviAgeParam");
        String[] params=(String[])session.getAttribute("hviParam");
        String orgUnitTitle="State: "+params[12]+"\t"+"        LGA: "+params[4]+"\t"+"         CBO: "+params[5]+"           Community: "+params[11];

        Paragraph titleParag=new Paragraph(new Phrase(title,f));
        Paragraph ageTitleParag=new Paragraph(new Phrase(ageTitle,f));
        Paragraph orgTitleParag=new Paragraph(new Phrase(orgUnitTitle,f));
        titleParag.setAlignment(Paragraph.ALIGN_CENTER);
        ageTitleParag.setAlignment(Paragraph.ALIGN_CENTER);
        orgTitleParag.setAlignment(Paragraph.ALIGN_CENTER);
        document.add(titleParag);
        document.add(ageTitleParag);
        document.add(orgTitleParag);

        document.addTitle("Household enrolment register");

        Paragraph p =new Paragraph(" ");
        document.add(p);

        float[] colsWidth = {0.6f, 1.2f,2f,1.5f,1.5f,0.6f,1f,0.9f,1f,1.2f,1.5f, 1.2f,1.2f};
        PdfPTable table = new PdfPTable(colsWidth);
        table.setWidthPercentage(100f);

        PdfPCell c2 = new PdfPCell(new Phrase("SNo.",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
                c2.setHorizontalAlignment(Element.ALIGN_CENTER);
                table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Unique id",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Household head name",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Address",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Age",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Sex(M/F)",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                /*c2 = new PdfPCell(new Phrase("Phone",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);*/
                c2 = new PdfPCell(new Phrase("Marital status",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Occupation",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("No. of children in Household",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("No. of people in household",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);

                c2 = new PdfPCell(new Phrase("Date of assessment(mm/dd/yyyy)",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Recorded by",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Last modified (mm/dd/yyyy)",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                /*c2 = new PdfPCell(new Phrase("Partner",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Household headship",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Health",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Education level",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Shelter and housing",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Food security and nutrition",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Means of livelihood",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Household income",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Vulnerability score",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);
                c2 = new PdfPCell(new Phrase("Vulnerability status",f));
                c2.setBackgroundColor(BaseColor.YELLOW);
		table.addCell(c2);*/
                /*
                */

        List hviList=(List)session.getAttribute("hviRecords");
        //List hviList=(List)mainList.get(0);
        int i=1;

                HouseholdEnrollment hvi=null;
                for(Object s:hviList)
                {
                     hvi=(HouseholdEnrollment)s;
                    Phrase phr=new Phrase(i+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhUniqueId(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhSurname()+" "+hvi.getHhFirstname(),f);
                    table.addCell(phr);
                    //phr=new Phrase(hvi.getCaregiverSurname()+" "+hvi.getCaregiverFirstname(),f);
                    //table.addCell(phr);
                    phr=new Phrase(hvi.getAddress(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhAge()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhGender(),f);
                    table.addCell(phr);
                    /*phr=new Phrase(hvi.getPhone(),f);
                    table.addCell(phr);*/
                    phr=new Phrase(hvi.getMaritalStatus(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getOccupation(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getNoOfChildrenInhh()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getNoOfPeopleInhh()+"",f);
                    table.addCell(phr);

                    phr=new Phrase(hvi.getDateOfAssessment(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getRecordedBy(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getDateOfEntry(),f);
                    table.addCell(phr);
                    /*phr=new Phrase(hvi.getPartnerCode(),f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhHeadship()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHealth()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getEducationLevel()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getShelterAndHousing()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getFoodSecurityAndNutrition()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getMeansOfLivelihood()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getHhIncome()+"",f);
                    table.addCell(phr);
                    phr=new Phrase(hvi.getVulnerabilityScore()+"",f);
                    table.addCell(phr);*/
                    //phr=new Phrase(hvi.getVulnerabilityStatus(),f);
                    //table.addCell(phr);
                    /**/
                    i++;
                }
                document.add(table);

    }catch(Exception e){
        e.printStackTrace();
    }
    document.close();
    return null;
    }
}
